#!/bin/bash

AIP_DIR="/mnt/sda3/_SRC/_builder/aipsetup"

#set -x

if [ ! -d "$AIP_DIR" ]
then
    echo " SORRY: please, install aipsetup (if not yet),"
    echo "        and run this from main program (aipsetup)"
    echo " ERROR: AIP_DIR not set"
    exit 1
fi

standardparser_input_filename=
standardparser_output_name=
standardparser() {
    local i
    local l
    local versions
    local versions2
    local arch
    for (( i=0 ; i != 10 ; i++ ))
    do
	local v[$i]=
    done
    local aipsetupbuild
    local isaippackage

    standardparser_input_filename=`basename "$standardparser_input_filename"`

    echo "$standardparser_input_filename" | grep -E '\-[[:digit:]]{14}\-i.86-pc-linux-gnu' > /dev/null
    err="$?"
    if [ "$err" -eq 0 ]
    then
	isaippackage=1
	aipsetupbuild="$standardparser_input_filename"
	standardparser_input_filename=`echo "$standardparser_input_filename" | sed -e 's,\-[[:digit:]]{14}\-i.86-pc-linux-gnu,,'`
    else
	isaippackage=0
    fi

    l=${#standardparser_input_filename}
    for (( i=l-1 ; i != -1 ; i-- ))
    do
	if [ "${standardparser_input_filename:$i:1}" = '-' ]
	then
	    standardparser_output_name=${standardparser_input_filename:0:$i}
	    archt=`bash "$AIP_DIR/_aipb_getarchtype" "$standardparser_input_filename"`
	    versions=` echo "$standardparser_input_filename" | sed -e "s/^$standardparser_output_name.//;s/\.$archt\$//"`
	    break
	fi
    done
    versions2=`echo "$versions" | sed -e "s/\./ /g"`
    i=0
    for l in $versions2
    do
	v[$i]=$l
	i="$(( $i + 1 ))"
    done
    echo "s:$standardparser_input_filename"
    echo "n:$standardparser_output_name"
    echo "a:$archt"
    echo "v:$versions"
    echo "vv:$versions2"
    echo "vc:$i"
    echo "ap:$isaippackage"
    echo "ab:$aipsetupbuild"

    for (( l=0 ; l != i; l++ ))
    do
	echo "v$l:${v[$l]}"
    done
    echo
}

for base_i in $*
do
    standardparser_input_filename=$base_i
    standardparser
done