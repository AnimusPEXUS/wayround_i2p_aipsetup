#!/bin/bash

if [ ! -d "$AIP_DIR" ]
then
    echo " SORRY: please, install aipsetup (if not yet),"
    echo "        and run this from main program (aipsetup)"
    echo " ERROR: AIP_DIR not set"
    exit 1
fi


ppwd="`pwd`"

#set -x 

for i in $*
do
    if [ ! -f "$i" ]
    then
	echo "file \"$i\" not found"
	continue
    fi
    
    pkgname=`echo "$i" | sed -e 's,.tar.bz2$,,'`

    tmpdir=`bash "$AIP_DIR/_aipb_gettempdir"`
    echo "tempdir = $tmpdir"
    if [ "$?" -eq 1 ]
    then
	echo "cant get temp dir"
	continue
    fi

    tmpdir_pkgname="$tmpdir/$pkgname"
    mkdir -p "$tmpdir_pkgname"

    bash "$AIP_DIR/_aipb_install" -b "$tmpdir_pkgname" "$i"
    
    bash "$AIP_DIR/_aipb_move_bzip2_to_xz" -b "$tmpdir_pkgname" <<EOF
yes
EOF
    
    cd "$tmpdir_pkgname"
    
    bash "$AIP_DIR/_aipb_pack"

    cd ../pack

    mv -v * "$ppwd"
    
    cd "$ppwd"

    rm -v -r "$tmpdir"
done

exit 0